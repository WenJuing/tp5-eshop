(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{27:function(e,t,n){e.exports=n(46)},37:function(e,t,n){},38:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){},43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){"use strict";n.r(t);var a=n(2),o=n.n(a),r=n(1),s=n(9),c=n(0),i=n.n(c),l=n(18),d=n(12),u=n(4),m=n(5),p=n(7),h=n(6),g=n(8),v=(n(37),n(38),n(15)),f=n(17),y=n.n(f),b=(n(41),"");function E(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).baseUrl,t=void 0===e?"":e;arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.baseUrl=t}b=["START","STAGE","ONLINE"].includes("ONLINE")?"https://api.dangdang.com/kefu/outerService":"http://10.255.242.222:8092/outerService",E.create=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return fetch()},E.prototype={constructor:E,create:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]},get:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{method:"GET",mode:"cors",headers:{Accept:"application/json"}},a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).reduce(function(t,n,a,o){return t+"&"+n+"="+e[n]},"")}(t);return fetch(this.baseUrl+"/"+e+"?"+a,n).then(function(e){return e.json()}).catch(function(e){return console.error("API Err:",e),{http:-1}})},post:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{method:"POST",credentials:"include",mode:"cors",headers:{"content-type":"application/json"}};return n.body=JSON.stringify(t),fetch(this.baseUrl+"/"+e,n).then(function(e){return e.json()}).catch(function(e){return console.error("API Err:",e),{http:-1}})},file:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{method:"POST",credentials:"include",mode:"cors"};return n.body=t,fetch(this.baseUrl+"/"+e,n).then(function(e){return e.json()}).catch(function(e){return console.error("API Err:",e),{http:-1}})}};var I=new E({baseUrl:b});function S(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sessionId,n=void 0===t?"":t,a=e.tenantId,o=void 0===a?1:a;return I.get("queryLatest7DaysMsg",{sessionId:n,tenantId:o})}function k(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e.shopId,e.sessionId),n=void 0===t?"":t,a=e.tenantId,o=void 0===a?1:a;return I.get("queryOrderList",{sessionId:n,tenantId:o})}function N(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.shopId,n=void 0===t?"0":t,a=e.ddShopId,o=void 0===a?"0":a,r=e.sourcePage,s=void 0===r?"":r,c=e.fromPlatform,i=void 0===c?1:c,l=e.tenantId,d=void 0===l?1:l;return I.get("queryShopInfo",{shopId:n,ddshopId:o,sourcePage:s,fromPlatform:i,tenantId:d})}function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.productId,n=void 0===t?0:t,a=e.tenantId,o=void 0===a?1:a;return I.get("queryProductInfo",{productId:n,tenantId:o})}function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.orderId,n=void 0===t?0:t,a=e.sessionId,o=void 0===a?"":a,r=e.tenantId,s=void 0===r?1:r;return I.get("queryOrderDetailSimple",{orderId:n,sessionId:o,tenantId:s})}function M(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.reverseApplyId,n=void 0===t?0:t,a=e.sessionId,o=void 0===a?"":a,r=e.tenantId,s=void 0===r?1:r;return I.get("queryReverseOrderInfo",{reverseApplyId:n,sessionId:o,tenantId:s})}function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fromPlatform,n=void 0===t?0:t,a=e.sessionId,o=void 0===a?"":a,r=e.tenantId,s=void 0===r?1:r;return I.get("queryPoint",{fromPlatform:n,sessionId:o,tenantId:s})}var R="";function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sessionId,n=void 0===t?"":t,a=e.tenantId;return fetch(R+"/getCustInfo?tenantId="+(void 0===a?1:a)+"&sessionId="+n,{}).then(function(e){return e.json()}).catch(function(e){return console.error("API Err:",e),{http:-1}})}R=["START","STAGE","ONLINE"].includes("ONLINE")?"https://api.dangdang.com/kefu/accountService":"http://10.255.242.222:8092/accountService";var j="";function D(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.roomId,n=void 0===t?"":t,a=e.staffCustId,o=void 0===a?0:a,r=e.tenantId,s=void 0===r?1:r,c=e.commentSource,i=void 0===c?0:c,l=e.token,d=void 0===l?"":l,u=e.rewardType,m=void 0===u?1:u,p=e.rewardValue,h=void 0===p?0:p,g=e.isReward,v=void 0===g?0:g,f=e.commentDegree,y=void 0===f?0:f,b=e.commentNote,E=void 0===b?"":b,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{method:"POST",mode:"cors",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};return I.body=JSON.stringify({roomId:n,staffCustId:o,token:d,rewardType:m,rewardValue:h,isReward:v,commentDegree:y,tenantId:s,commentSource:i,commentNote:E}),fetch(j+"/commentSession",I).then(function(e){return e.json()}).catch(function(e){return console.error("API Err:",e),{http:-1}})}j=["START","STAGE","ONLINE"].includes("ONLINE")?"https://api.dangdang.com/kefu/sessionService":"http://10.255.242.222:8092/sessionService";var _="";function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.file,n=void 0===t?"":t,a=e.sessionId,o=void 0===a?"":a,s=e.userType,c=void 0===s?1:s,i=e.tenantId,l=void 0===i?1:i,d=e.roomId,u=void 0===d?"0":d,m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{method:"POST",mode:"cors"},p=new FormData;return p.append("file",n),p.append("sessionId",o),p.append("userType",c),p.append("tenantId",l),p.append("roomId",u),fetch(_,Object(r.a)({},m,{body:p})).then(function(e){return e.json()}).catch(function(e){return console.error("err:",e),{http:-1}})}_=["START","STAGE","ONLINE"].includes("ONLINE")?"https://kefufile.dangdang.com:8088/upload/image/1":"http://10.255.242.225:8088/upload/image/1";var P=n(19),A=n.n(P),L={"[WX]":1,"[TS]":2,"[FK]":3,"[SS]":4,"[MJ]":5,"[GC]":6,"[QQ]":7,"[GL]":8,"[ZY]":9,"[DX]":10,"[WN]":11,"[CM]":12,"[CQ]":13,"[DK]":14,"[ZY2]":15,"[LL]":16,"[DO]":17,"[XO]":18,"[MX]":19,"[MA]":20,"[MP]":21,"[MQ]":22,"[MN]":23,"[MK]":24,"[MG]":25,"[QW]":26,"[AX]":27,"[XG]":28,"[BGX]":29,"[HH]":30,"[PY]":31,"[JJ]":32,"[BX]":33,"[ZBX]":34,"[DH]":35,"[XC]":36,"[LLMM]":37,"[TX]":38,"[SH]":39,"[WL]":40,"[NWN]":41,"[OK]":42,"[SW]":43,"[SM]":44,"[YW]":45,"[JT]":46,"[AN]":47};function H(){}function q(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/\[[A-Z1-9]{1,4}.?\]/g,function(e){return L[e]?'<img class="msg-emoji" src="'.concat("http://static.dangdang.com/cim/public","/images/emojis/").concat(L[e],'.png" />'):e})}H.prototype={constrouter:H};n(25);var F=function(){},U="";U="http://returnlocal.dangdang.com:5084/reverseapplydetail.aspx?apply_id=";var G=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={isShowEmoji:!1},n.sendTempMsg=n.sendTempMsg.bind(Object(v.a)(n)),n}return Object(g.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=(t.user,t.owner),a=(t.roomId,t.historyMsg),o=t.historyMsgSeq,r=t.chatMsg;return i.a.createElement("div",{className:"chatbox",onClick:function(){return e.setState({isShowEmoji:!1})}},i.a.createElement("div",{ref:"scrollDiv",className:"chatbox_msgs"},i.a.createElement("div",{className:"msgs-container"},i.a.createElement("div",{className:"msg-item msg-center",style:{display:o>-1?"flex":"none"}},i.a.createElement("s",null),i.a.createElement("span",{className:"msg-link",onClick:function(){return e.props.onGetHistoryMsgs()}},"\u70b9\u51fb\u52a0\u8f7d\u5386\u53f2\u6d88\u606f"),i.a.createElement("s",null)),i.a.createElement("div",{id:"historyMsgs",className:"history-list",style:{display:a.length>0?"block":"none"}},this.handleMsgs(a,!0)),i.a.createElement("div",{className:"msg-item msg-center",style:{display:a.length>0?"flex":"none"}},i.a.createElement("s",null),i.a.createElement("span",null," \u4ee5\u4e0b\u4e3a\u6700\u65b0\u6d88\u606f")," ",i.a.createElement("s",null)),i.a.createElement("div",{id:"chatMsgs",className:"msg-list"},this.handleMsgs(r)))),i.a.createElement("div",{className:"chatbox_msgSending"},i.a.createElement("div",{className:"line-divide-row"}),i.a.createElement("div",{className:"msgSending-toolbar"},i.a.createElement("div",{className:""},i.a.createElement("i",{className:"icon icon-face",title:"\u63d2\u5165\u8868\u60c5",onClick:function(t){t.stopPropagation(),e.toggleShowEmoji()}}),i.a.createElement("i",{className:"icon icon-pic ".concat(0!==n.status?"icon-not-allowed":""," "),title:"\u53d1\u9001\u56fe\u7247",onClick:function(){0===n.status&&e.refs.img.click()}},i.a.createElement("input",{ref:"img",onChange:function(t){return e.sendImg(t)},type:"file",accept:".jpg,.png",style:{visibility:"hidden",display:"none"}})),i.a.createElement("i",{className:"icon icon-heart ".concat(2!=n.userType||1==n.hasCommented?"icon-not-allowed icon-heart-black":""," "),title:"\u5bf9\u5ba2\u670d\u8bc4\u4ef7",onClick:function(){e.props.onOpenComment()}}),i.a.createElement("i",{className:"icon icon-kefu ".concat(0==n.status&&3==n.userType?"":"icon-not-allowed"," "),title:"\u8f6c\u4eba\u5de5\u5ba2\u670d",onClick:function(){e.toggleOwner()}})),i.a.createElement("div",{className:"msgSending-toolbar-others"},i.a.createElement("i",{className:"icon ".concat("fold"===this.props.channelFold?"icon-menu-right":"icon-menu-left"),title:"fold"===this.props.channelFold?"\u6253\u5f00\u4fa7\u8fb9\u680f":"\u6536\u8d77\u4fa7\u8fb9\u680f",onClick:function(t){e.toggleChannel(t)}})),i.a.createElement("div",{className:"msgSending-emoji",style:{display:this.state.isShowEmoji?"block":"none"}},i.a.createElement("ul",{className:"emoji-list"},Object.keys(L).map(function(t){var n=L[t];return i.a.createElement("li",{className:"emoji-item",key:n,onClick:function(n){n.stopPropagation(),e.addEmoji(t)}},i.a.createElement("img",{src:"http://static.dangdang.com/cim/public/images/emojis/"+n+".png"}))})))),i.a.createElement("div",{className:"msgSending-text"},i.a.createElement("textarea",{ref:"txt",defaultValue:"",maxLength:"200",rows:"3",placeholder:"\u8bf7\u8f93\u5165\u60a8\u8981\u54a8\u8be2\u7684\u95ee\u9898",onChange:A()(this.sendTempMsg,800),onKeyDown:function(t){e.handleTextareaKeyDown(t)}})),i.a.createElement("div",{className:"msgSending-operation"},i.a.createElement("span",{className:"btn-notice ".concat(0==n.status||1==n.status?"":"btn-disabled"),onClick:function(){e.sendMsg(6,1)}},"\u53d1\u9001"))))}},{key:"handleRobotMsg_richText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(JSON.parse(e.content).line||[]).map(function(e,t){return i.a.createElement("p",{key:t},2===e.type&&e.image&&i.a.createElement(y.a,null," ",i.a.createElement("img",{className:"msg-img",src:e.image.url})," "),1===e.type&&e.text&&i.a.createElement("span",{dangerouslySetInnerHTML:{__html:e.text}}))})}},{key:"handleRobotMsg",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),n=t.guide||t.recommendQuestion;return i.a.createElement(i.a.Fragment,null,t.text&&i.a.createElement("div",{className:"msg-robot msg-text"},t.text.content),t.image&&i.a.createElement(y.a,null,i.a.createElement("img",{className:"msg-robot msg-img",src:t.image.url+"?sessionId="+this.props.user.sessionId+"&userType=1&tenantId=1"})),t.richText&&i.a.createElement("div",{className:"msg-robot msg-richText",dangerouslySetInnerHTML:{__html:t.richText.original}}),t.news&&Array.isArray(t.news.articles)&&i.a.createElement("div",{className:"msg-robot msg-news-list"},t.news.articles.map(function(e,t){return i.a.createElement("div",{className:"msg-robot msg-news-item",key:t},i.a.createElement("div",{className:"msg-new-title"},e.title),e.description&&i.a.createElement("div",{className:"msg-new-desc"},e.description),i.a.createElement(y.a,null,i.a.createElement("img",{className:"msg-robot msg-img",src:e.picurl})))})),n&&Array.isArray(n.list)&&i.a.createElement("div",{className:"msg-robot-list"},i.a.createElement("div",{className:"msg-robot-list-before"},n.beforeWord),i.a.createElement("ul",{className:"msg-robot-list-body"},n.list.map(function(t,n){return i.a.createElement("li",{className:"msg-link",key:n,onClick:function(){e.props.onSendMsg(6,1,t.question)}},t.seq+"."+t.question)})),n.afterWord&&i.a.createElement("div",{className:"msg-robot-list-after"},n.afterWord)))}},{key:"handleMsgContent",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.msgType,a=void 0===n?1:n,o=t.content,r=void 0===o?"":o;if([2,7,8].includes(a))try{r=JSON.parse(r)}catch(l){console.error("handle msg content Err content:",r)}switch(a){case 1:return i.a.createElement("div",{className:"msg-text",dangerouslySetInnerHTML:{__html:q(W(r))}});case 2:return i.a.createElement(y.a,null,i.a.createElement("img",{className:"msg-img",src:r.url+"?sessionId="+this.props.user.sessionId+"&userType=1&tenantId=1"}));case 7:var s="";return"order"===r.cardType&&(s="//order.dangdang.com/orderdetails.aspx?orderid="),"reverse"===r.cardType&&(s=U),i.a.createElement("div",{className:"msg-card msg-card-".concat(r.cardType)},i.a.createElement("div",{className:"msg-card-preview"},i.a.createElement("img",{src:r.picUrl})),i.a.createElement("div",{className:"msg-card-body"},"product"==r.cardType?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"msg-product-desc text-multipleLine"},i.a.createElement("a",{className:"text-multipleLine",href:"//product.dangdang.com/"+r.bizId+".html",target:"_blank"},r.desc||"--")),i.a.createElement("span",{className:"msg-product-price"},"\uffe5",void 0===r.price?"--":r.price)," "):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"msg-order-bizId"},"reverse"===r.cardType?"\u7533\u8bf7\u5355\u53f7":"\u8ba2\u5355\u7f16\u53f7","\uff1a",i.a.createElement("a",{href:s+r.bizId,target:"_blank"},r.bizId||"--")),i.a.createElement("div",{className:"msg-order-total"},"\u8ba2\u5355\u91d1\u989d\uff1a\uffe5",void 0===r.price?"--":r.price),i.a.createElement("div",{className:"msg-order-date"},"reverse"===r.cardType?"\u7533\u8bf7":"\u4e0b\u5355","\u65f6\u95f4\uff1a",r.orderDate||"--"),i.a.createElement("div",{className:"msg-order-status"},"\u8ba2\u5355\u72b6\u6001\uff1a",r.orderStatus||"--"))));case 8:var c=r.msgType;return this.handleRobotMsg(c,r);case"command":return i.a.createElement("div",{className:"msg-command",onClick:function(){return e.props.onSendMsg(r.command)}},i.a.createElement("div",{className:"msg-command-desc"},r.desc),i.a.createElement("div",{className:"msg-command-title"},r.title));case"joinRoom":return i.a.createElement("div",{className:"msg-joinRoom"},"\u5f53\u524d\u8fde\u63a5\u5df2\u7ecf\u65ad\u5f00\u3002\u70b9\u51fb\u7acb\u5373",i.a.createElement("span",{className:"msg-link",onClick:function(){return e.props.onJoinRoom(r)}},"\u8054\u7cfb\u5ba2\u670d"));default:return i.a.createElement("div",null,"\u4e0d\u652f\u6301\u7684\u6d88\u606f\u683c\u5f0f\uff01")}}},{key:"handleMsgs",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],this.props),a=n.user,o=n.owner,r=n.onResendMsg;return i.a.createElement(i.a.Fragment,null,t.map(function(t,n){var s=t.msgId,c=t.msgType,l=t.senderType,d=t.msgStatus,u=t.content,m=t.contentType,p=t.msgUser,h=u;if("notify"===c)return i.a.createElement("div",{className:"msg-item msg-center",key:n},i.a.createElement("s",null),i.a.createElement("span",null,u),i.a.createElement("s",null));if("timeMsg"===c)return i.a.createElement("div",{className:"msg-item msg-timeMsg",key:n},i.a.createElement("span",null,u));if("rengong"===c)return i.a.createElement("div",{className:"msg-item msg-rengong",key:n},i.a.createElement("div",{className:"msg-rengong-body"},i.a.createElement("img",{src:u.portraitUrl}),i.a.createElement("p",{className:"owner-star"},new Array(o.star).fill(0).map(function(e,t){return i.a.createElement("i",{className:"icon icon-star icon-star-red",key:t})}))));var g="http://static.dangdang.com/cim/public/images/robot.png",v="\u667a\u80fd\u5ba2\u670d";return 2==l&&(g=p?p.portraitUrl:"http://static.dangdang.com/cim/public/images/kefu.png",v=p?p.nickname:"\u4eba\u5de5\u5ba2\u670d"),1===l&&(g=a.portraitUrl||"http://static.dangdang.com/cim/public/images/user.png",v=a.nickname||"\u65e0\u6635\u79f0\u7528\u6237"),1==c&&2==l&&(h=J(h)),i.a.createElement("div",{className:"msg-item msg-type-".concat(c||m," msg-status-").concat(d," msg-senderType-").concat(l),key:n},i.a.createElement("div",{className:"msg-nickname"},v),i.a.createElement("div",{className:"msg-body"},i.a.createElement("img",{src:g}),i.a.createElement("div",{className:"msg-content"},e.handleMsgContent({msgType:c||m,content:h}),i.a.createElement("span",{className:"msg-content-arraw"})),i.a.createElement("i",{className:"icon",title:"error"==d?"\u70b9\u51fb\u91cd\u65b0\u53d1\u9001":"",onClick:function(){r(s)}})))}))}},{key:"handleTextareaKeyDown",value:function(e){var t=e.keyCode||e.which||e.charCode;if((e.ctrlKey||e.metaKey)&&13==t){var n=this.refs.txt,a=n.value;n.value=a+"\r\n"}else 13==t&&(e.preventDefault(),this.sendMsg(6,1))}},{key:"sendImg",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n,a,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target,a=n.files[0],F("send img:",a),a&&("image/jpeg"==a.type||"image/png"==a.type)){e.next=5;break}return e.abrupt("return",alert("\u56fe\u7247\u683c\u5f0f\u4e0d\u5408\u6cd5\uff01"));case 5:return e.next=7,x({file:a,sessionId:this.props.user.sessionId});case 7:if(r=e.sent,F("upload img result:",r),n.value="","object"==typeof r.data){e.next=12;break}return e.abrupt("return",alert("\u4e0a\u4f20\u56fe\u7247\u5931\u8d25\uff0c\u6362\u4e00\u5f20\u56fe\u7247\u8bd5\u8bd5\uff01"));case 12:this.props.onSendMsg(6,2,r.data);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sendMsg",value:function(e,t){F("send msg.command:",e);var n=this.props,a=n.owner,o=n.onSendMsg;if(a&&!(-1==a.status||a.status>1)){var r=this.refs.txt,s=r.value;if(s=W(J(s)),8==e)return o(e,t,s);if(!s&&6==e)return alert("\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\uff01");o(e,t,s),2==a.userType&&1==a.status&&o(15),r.value="";var c=this.refs.scrollDiv,i=c.scrollTop,l=c.scrollHeight;F("scroll dev",i,l),c.scrollTop=c.scrollHeight}}},{key:"sendTempMsg",value:function(){this.sendMsg(8,1)}},{key:"addEmoji",value:function(e){var t=this.refs.txt;t.value;t.value+=e}},{key:"toggleShowEmoji",value:function(){var e=this.state.isShowEmoji;e=!e,this.setState({isShowEmoji:e})}},{key:"toggleOwner",value:function(){var e=this.props,t=e.owner,n=e.onSendMsg;0==t.status&&(3==(t.userType||0)&&n(15))}},{key:"toggleChannel",value:function(e){var t=e.target,n=t.className.includes("icon-menu-right");t.className=n?"icon icon-menu-left":"icon icon-menu-right",this.props.onToggleChannelFold(t.className=n?"unfold":"fold")}},{key:"componentDidMount",value:function(){F("componentDidMount")}},{key:"getSnapshotBeforeUpdate",value:function(e){if(e.roomId===this.props.roomId&&e.historyMsg.length!==this.props.historyMsg.length){F("record postion of history");var t=this.refs.scrollDiv;return t.scrollHeight-t.scrollTop}return null}},{key:"componentDidUpdate",value:function(e,t,n){F("componentDidUpdate");var a=this.refs.scrollDiv;a.scrollTop;null!==n&&(a.scrollTop=a.scrollHeight-n),e.roomId!==this.props.roomId&&(a.scrollTop=a.scrollHeight),e.chatMsg.length!==this.props.chatMsg.length&&(a.scrollTop=a.scrollHeight)}}]),t}(c.Component);function W(e){return e.replace(/[\r\n\u21b5]/g,"<br>")}function J(e){return e.replace(/[<>&"]/g,function(e){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[e]})}G.defaultProps={chatMsg:[],historyMsg:[]};var V=n(14),Y=n(10);var Q={sessionId:"",userType:1,nickname:"",portraitUrl:"",status:0};var X=Object(V.b)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER":return Object(r.a)({},e,t.user);default:return e}},recentOrders:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case"SET_RECENT_ORDERS":return t.orders;default:return e}},points:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_POINTS":return t.points;default:return e}},isShowComment:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_IS_SHOW_COMMENT":return t.isShow;default:return e}},IMCStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"closed",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_IMC_STATUS":return t.status;default:return e}},activatedRoom:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case"SET_ACTIVATED_ROOM":return t.roomId;default:return e}},rooms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case"SET_ROOM":var n=t.roomId,a=t.room;return Object(r.a)({},e,Object(Y.a)({},n,Object(r.a)({},e[n],a)));case"SET_ROOMS":var o={};return t.rooms.map(function(e){o[e.roomId]=e}),o;case"DELETE_ROOM":return delete Object(r.a)({},e)[t.roomId];default:return e}},roomFilter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_FILTER":return t.shopName;default:return e}},roomVisibleIds:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_VISIBLE_IDS":return t.roomIds;default:return e}},roomShops:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.roomId,a=t.shop;switch(t.type){case"ADD_ROOM_SHOP":return Object(r.a)({},e,Object(Y.a)({},n,a));default:return e}},roomQuestions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.roomId,a=t.question;switch(t.type){case"ADD_ROOM_QUESTION":return Object(r.a)({},e,Object(Y.a)({},n,a));default:return e}},roomOwners:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.roomId,a=t.owner;switch(t.type){case"SET_ROOM_OWNER":return Object(r.a)({},e,Object(Y.a)({},n,Object(r.a)({},e[n],a)));default:return e}},orders:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.sourceContent,a=t.order;switch(t.type){case"ADD_ORDER":return Object(r.a)({},e,Object(Y.a)({},n,a));default:return e}},products:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.sourceContent,a=t.product;switch(t.type){case"ADD_PRODUCT":return Object(r.a)({},e,Object(Y.a)({},n,a));default:return e}},roomHistoryMsgSeqs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.roomId,o=t.seq;switch(n){case"SET_ROOM_HISTORY_MSG_SEQ":return Object(r.a)({},e,Object(Y.a)({},a,o));default:return e}},roomHistoryMsgs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.roomId,a=t.msgs;switch(t.type){case"SET_ROOM_HISTORY_MSG":return Object(r.a)({},e,Object(Y.a)({},n,a));case"ADD_ROOM_HISTORY_MSG":return Object(r.a)({},e,Object(Y.a)({},n,a.concat(e[n])));default:return e}},chatMsgs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.msgId,a=t.msg;switch(t.type){case"ADD_CHAT_MSG":return Object(r.a)({},e,Object(Y.a)({},n,a));case"SET_CHAT_MSG":return Object(r.a)({},e,Object(Y.a)({},n,Object(r.a)({},e[n],a)));default:return e}},roomChatMsgIds:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.roomId,a=t.msgIds;switch(t.type){case"SET_ROOM_CHAT_MSG_ID":return Object(r.a)({},e,Object(Y.a)({},n,a));case"ADD_ROOM_CHAT_MSG_ID":return e[n]||(e[n]=[]),Object(r.a)({},e,Object(Y.a)({},n,e[n].concat(a)));case"DELETE_ROOM_CHAT_MSG_ID":var o=t.msgId;return console.log("smgid ",o),Object(r.a)({},e,Object(Y.a)({},n,e[n].filter(function(e){return e!=o})));default:return e}},activatedChannel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1001",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ACTIVATED_CHANNEL":return t.id;default:return e}},channelFold:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unfold",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CHANNEL_FOLD":return t.fold;default:return e}}}),z=Object(V.c)(X);function B(){return{type:"SET_ROOM",roomId:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,room:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}}function K(){return{type:"SET_ROOM_OWNER",roomId:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,owner:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}}function Z(){return{type:"ADD_ROOM_SHOP",roomId:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,shop:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}}function $(){return{type:"ADD_ORDER",sourceContent:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",order:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}}function ee(){return{type:"ADD_PRODUCT",sourceContent:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",product:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}}function te(e){return{type:"SET_ROOM_HISTORY_MSG_SEQ",roomId:e,seq:arguments.length>1&&void 0!==arguments[1]?arguments[1]:""}}function ne(){return{type:"SET_ROOM_CHAT_MSG_ID",roomId:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,msgIds:arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]}}function ae(){return{type:"ADD_ROOM_CHAT_MSG_ID",roomId:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,msgIds:arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]}}function oe(){return{type:"ADD_CHAT_MSG",msgId:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,msg:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}}function re(){return{type:"SET_CHAT_MSG",msgId:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,msg:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}}function se(){return{type:"SET_ROOMS",rooms:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}}function ce(){return{type:"SET_ROOM_VISIBLE_IDS",roomIds:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}}function ie(e){return{type:"SET_USER",user:e}}function le(){return{type:"SET_ACTIVATED_ROOM",roomId:arguments.length>0&&void 0!==arguments[0]?arguments[0]:""}}function de(){return{type:"SET_RECENT_ORDERS",orders:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}}function ue(){return{type:"SET_POINTS",points:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0}}function me(){return{type:"SET_IS_SHOW_COMMENT",isShow:arguments.length>0&&void 0!==arguments[0]&&arguments[0]}}function pe(){return{type:"SET_IMC_STATUS",status:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"closed"}}var he=z.dispatch;function ge(e){var t=z.getState(),n=t.activatedRoom||0,a=(t.roomChatMsgIds||{})[n]||[],o=new Date;if(e||(e=o.getTime()),e-(a.slice(-1)||{})>12e4){var r={msgId:e,msgType:"timeMsg",senderType:"system",content:o.getHours()+":"+o.getMinutes()};he(oe(e-1,r)),he(ae(n,[e-1]))}}function ve(e){setTimeout(function(){"loading"==z.getState().chatMsgs[e].msgStatus&&he(re(e,{msgStatus:"error"}))},5e3)}function fe(e){z.getState().roomHistoryMsgs[e]||(he(function(){return{type:"SET_ROOM_HISTORY_MSG",roomId:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,msgs:arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]}}(e,[])),he(te(e,0)))}function ye(e){z.getState().roomChatMsgIds[e]||he(ne(e,[]))}function be(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";z.getState().roomQuestions[e]||function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.shopId,n=void 0===t?0:t,a=e.sessionId,o=void 0===a?"":a,r=e.tenantId,s=void 0===r?1:r;return I.get("queryDefaultQuestions",{shopId:n,sessionId:o,tenantId:s})}({shopId:t,ddShopId:n}).then(function(t){if(t.data){var n=t.data.defaultQuestions||[];he(function(){return{type:"ADD_ROOM_QUESTION",roomId:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,question:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}}(e,n))}})}function Ee(){return Ie.apply(this,arguments)}function Ie(){return(Ie=Object(s.a)(o.a.mark(function e(){var t,n,a,s,c,i,l,d,u,m,p=arguments;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=p.length>0&&void 0!==p[0]?p[0]:"",n=p.length>1&&void 0!==p[1]?p[1]:"",a=z.getState(),"order"!==t&&"reverse"!==t){e.next=20;break}if(s=a.products,c=z.getState().user,i=c.sessionId,!s[n]){e.next=9;break}return e.abrupt("return");case 9:if("order"!==t){e.next=15;break}return e.next=12,w({sessionId:i,orderId:n});case 12:d=e.sent,e.next=18;break;case 15:return e.next=17,M({sessionId:i,reverseApplyId:n});case 17:d=e.sent;case 18:return d.data&&(u=d.data.productList||[],l=Object(r.a)({},d.data,{productList:u,orderId:n}),he($(n,l))),e.abrupt("return");case 20:if("product"!==t){e.next=29;break}if(!a.products[n]){e.next=24;break}return e.abrupt("return");case 24:return e.next=26,O({productId:n});case 26:d=e.sent,m=d.data||{},he(ee(n,m));case 29:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Se(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,n=void 0===t?"":t,a=e.data,o=void 0===a?{}:a,r=window.top||r;r!=window&&r.postMessage({type:n,data:o},"*")}var ke=function(){var e=document.createElement("div");e.addEventListener("outputmsg",function(e){e.detail});var t,n={0:"test",1:"connect",3:"session",6:"req",7:"res",8:"req",9:"withdraw",11:"",13:"heartBeat",15:""};function a(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=n.serverUrl,o=void 0===a?"":a,r=n.isLog,s=void 0!==r&&r,c=n.connId,i=void 0===c?0:c,l=n.userId,d=void 0===l?"":l;return t||(t=this,this.serverUrl=o,this.isLog=s,Object.getPrototypeOf(this).log=this.isLog?console.log.bind(this,"%cIMS::","color:#3f3"):function(){},this.socket={},this.socketState=3,this.sessionId="",this.userId=d,this.connId=i,this.eventTarget=document.createElement("div"),this.eventTarget.addEventListener("handleMsg",function(t){var n=t.detail;e.onHandleMsg(n)}),this.eventTarget.addEventListener("handleErr",function(t){var n=t.detail;e.onHandleErr(n)}),this.eventTarget.addEventListener("handleSucc",function(t){var n=t.detail;e.onHandleSucc(n)}),this.init(),this)}return a.prototype={constructor:a,init:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.log("init sessionId",t);var n=new WebSocket(this.serverUrl);this.socket=n,this.socket.addEventListener("open",function(n){e.log("WebSocket is open now.",n),e.onHandleMsg({command:"opened",event:n}),e.socketState=1,t&&e.setConnection(t)}),this.socket.addEventListener("close",function(t){e.log("WebSocket is closed now.",t),e.socket.close(),e.onHandleMsg({command:"closed",event:t})}),this.socket.addEventListener("error",function(t){e.log("WebSocket is error now.",t),e.onHandleMsg({command:"error",event:t})}),this.socket.addEventListener("message",function(t){e.log("WebSocket on message from server ",t);var n=t.data;try{n=JSON.parse(n)}catch(a){return console.warn("data is not json parse error",a),alert("\u6d88\u606f\u8fd4\u56de\u51fa\u9519")}e.onMsg(n),e.onHandleMsg(n)})},setConnection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.log("set connection",e,this.socket.readyState),e?this.socket.readyState!==WebSocket.OPEN?(this.debug("\u4e0e\u670d\u52a1\u5668\u8fde\u63a5\u6ca1\u6709\u5f00\u542f\uff01\u6b63\u5728\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5..."),void this.init(e)):(this.sessionId=e,void this.socket.send(JSON.stringify({command:1,connId:this.connId,version:"1.1",tenantId:1,connect:{userSession:e,userType:1,fromPlatform:0,ip:"",area:"area"}}))):(this.debug("\u8bf7\u4f20\u5165\u6b63\u786e\u7684session\uff1a",e),void this.onHandleMsg({command:"Err-setConnection",type:"",text:"\u5efa\u7acb\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u8f93\u5165\u6b63\u786e\u7684sessionId\uff01"}))},joinRoom:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e.userId,e.msgId),n=void 0===t?0:t,a=e.shopId,o=void 0===a?"":a,r=e.ddShopId,s=void 0===r?"0":r,c=e.sourcePage,i=void 0===c?"":c,l=e.sourceContent,d=void 0===l?"":l;return this.log("joinRoom: shopId,sockStatus:",o,this.socket.readyState),o&&i?this.socket.readyState!==WebSocket.OPEN?(this.debug("joinRoom\uff1a\u4e0e\u670d\u52a1\u5668\u8fde\u63a5\u6ca1\u6709\u5f00\u542f\uff01\u6b63\u5728\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5...","\u8fde\u63a5\u6210\u529f\u540e\u8bf7\u91cd\u65b0\u52a0\u5165\u623f\u95f4",this.socket.readyState),this.onHandleMsg({command:"Err-joinRoom",code:2003,text:"\u52a0\u5165\u623f\u95f4\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01"}),void this.init(this.sessionId)):void this.socket.send(JSON.stringify({command:3,version:"1.1",tenantId:1,connId:this.connId,msgId:n,session:{userId:this.userId,shopId:o,ddShopId:s,type:1,sourcePage:i,sourceContent:d,fromPlatform:0}})):(this.debug("joinRoom: \u8bf7\u63d2\u5165\u6b63\u786e\u7684shop\uff1a",o),void this.onHandleMsg({command:"Err-joinRoom",code:2002,text:"\u52a0\u5165\u623f\u95f4\u5931\u8d25\uff0c\u5ba2\u670d\u53c2\u6570\u51fa\u9519\uff01"}))},ping:function(){this.log("socket ping"),this.socket.send(JSON.stringify({connId:this.connId,command:13,version:"1.1",tenantId:1,heartBeat:{hbMsg:"ping"}}))},sendMsg:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(this.log("socket state:",this.socket.readyState),!t)return this.onHandleMsg({command:"Err-sendMsg",code:2003,text:"\u53d1\u9001\u6d88\u606f\u5931\u8d25\u3002\u8bf7\u9009\u62e9\u53d1\u9001\u6d88\u606f\u5e97\u94fa "}),this.debug("sendMsg: \u8bf7\u63d2\u5165\u6b63\u786e\u7684shop\uff1a",t);if(t-=0,!a)return this.onHandleMsg({command:"Err-sendMsg",code:2004,text:"\u53d1\u9001\u6d88\u606f\u5931\u8d25\u3002\u8bf7\u8f93\u5165\u6d88\u606f\u6307\u4ee4"}),this.debug("sendMsg: \u8bf7\u63d2\u5165\u6b63\u786e\u7684 command\uff1a",a);if(this.socket.readyState!==WebSocket.OPEN)return this.init(this.sessionId),this.debug("sendMsg: \u4e0e\u670d\u52a1\u5668\u8fde\u63a5\u6ca1\u6709\u5f00\u542f\uff01\u6b63\u5728\u91cd\u65b0\u8fde\u63a5");var i=(e={msgId:o,connId:this.connId,roomId:t,command:13,version:"1.1"},Object(Y.a)(e,"command",a),Object(Y.a)(e,"tenantId",1),Object(Y.a)(e,"version","1.1"),Object(Y.a)(e,"token","token_001"),e),l=Object(r.a)({},i,Object(Y.a)({},n[a]||"lolo",{senderType:1,msgType:s,content:c}));this.socket.send(JSON.stringify(l))},onMsg:function(e){switch(e.command){case 2:var t=e.connId||0;if("number"!==typeof t)return;var n=e.userId||"";localStorage.setItem("cim_connId",t),this.dispatch("handleSucc",{action:"setConnection",command:2,msg:"\u7528\u6237\u901a\u9053\u5df2\u7ecf\u5efa\u7acb",data:{connId:t,userId:n}}),this.connId=t,this.userId=n;break;case 4:var a=e.roomId;this.dispatch("handleSucc",{action:"joinRoom",command:4,msg:"\u52a0\u5165\u623f\u95f4\u6210\u529f",data:a})}},onpen:function(){},dispatch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"handleMsg",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{action:"",msg:"",data:""},n=new CustomEvent(e,{detail:t});this.eventTarget.dispatchEvent(n)},onHandleMsg:function(){},onHandleSucc:function(){},onHandleErr:function(){},log:function(){},debug:console.log.bind(this,"%cIMS::","color:#f33"),dispatchEvent:e.dispatchEvent.bind(e),addEventListener:e.addEventListener},a}(),Ne="",Oe=!0;["START","STAGE","ONLINE"].includes("ONLINE")?(Ne="wss://kefulong.dangdang.com:9600",Oe=!1):Ne="ws://10.255.242.222:9600";var we=new ke({serverUrl:Ne,connId:0,isLog:Oe});["START","DEVLOP","3NDTEST","STAGEx"].includes("ONLINE")&&(window.ims=we);var Me=we,Te=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={},n}return Object(g.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.dispatch,a=t.channelFold,o=t.user,r=t.owner,s=t.roomId,c=t.chatMsg,l=t.historyMsg,d=t.historyMsgSeq;return i.a.createElement("div",{id:"chatroom"},i.a.createElement(G,{channelFold:a,chatMsg:c,historyMsg:l,historyMsgSeq:d,roomId:s,user:o,owner:r,onToggleChannelFold:function(e){Se({type:"channelFold",data:e}),n(function(){return{type:"SET_CHANNEL_FOLD",fold:arguments.length>0&&void 0!==arguments[0]?arguments[0]:""}}(e))},onOpenComment:function(){e.props.onHandleOpenComment()},onSendMsg:function(t,n,a){e.handleSendMsg(t,n,a)},onJoinRoom:function(t){e.handleJoinRoom(t)},onResendMsg:function(t){e.handleResendMsg(t)},onGetHistoryMsgs:function(){e.handleGetHistoryMsgs()},onSetScrollPos:function(t){e.handleScrollPos(t)}}))}},{key:"handleResendMsg",value:function(e){var t=this.props,n=t.dispatch,a=t.roomId,o=t.chatMsgs,r=o[e];console.log("resend msg",e,r,o);var s=r.msgType,c=r.content;n(re(e,{msgStatus:"loading"})),ve(e),Me.sendMsg(a,6,e,s,c)}},{key:"handleSendMsg",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=this.props,o=a.dispatch,s=a.roomId,c=a.allRooms;if(s){1!=t&&(n=JSON.stringify(n));var i=c[s],l=(new Date).getTime();switch(e){case 6:ge(l),o(oe(l,{msgId:l,msgType:t,msgStatus:"loading",senderType:1,content:n})),o(ae(s,[l])),ve(l),Me.sendMsg(s,e,l,t,n);break;case 8:Me.sendMsg(s,e,l,t,n);break;case 22:case 15:Me.sendMsg(s,e,l);break;case 21:Me.sendMsg(s,e,l),o(K(s,{nickname:"\u5f53\u524d\u6ca1\u6709\u5ba2\u670d",status:-1})),o(oe(l+1,{msgType:"joinRoom",senderType:3,content:Object(r.a)({},i)})),o(ae(s,[l+1]))}}}},{key:"handleJoinRoom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Me.joinRoom(e)}},{key:"handleGetHistoryMsgs",value:function(){var e,t=this.props,n=t.dispatch,a=t.roomId,o=t.historyMsgSeq;(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.userId,n=void 0===t?"":t,a=e.tenantId,o=void 0===a?1:a,r=e.roomId,s=void 0===r?0:r,c=e.pageSize,i=void 0===c?10:c,l=e.seq;return fetch(j+"/history?tenantId="+o+"&roomId="+s+"&pageSize="+i+"&seq="+(void 0===l?0:l)+"&userId="+n,{}).then(function(e){return e.json()}).catch(function(e){return console.error("API Err:",e),{http:-1}})})({roomId:a,seq:o}).then(function(t){if(t.data)if((e=t.data||[]).reverse(),n(function(){return{type:"ADD_ROOM_HISTORY_MSG",roomId:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,msgs:arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]}}(a,e)),e.length<10)n(te(a,-1));else{var o=e[0].seq;n(te(a,o))}})}},{key:"handleScrollPos",value:function(e){var t=this.props;(0,t.dispatch)(B(t.roomId,{scrollPos:e}))}},{key:"componentDidMount",value:function(){var e=Object(s.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),t}(c.Component);function Re(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[];return t.map(function(t){n.push(e[t])}),n}function Ce(e,t){var n;return t&&(n=e[t]||{}),Object(r.a)({status:-1,userType:-1,star:0},n)}for(var je=Object(d.b)(function(e){return{roomId:e.activatedRoom,allRooms:e.rooms,chatMsgs:e.chatMsgs,chatMsg:Re(e.chatMsgs,e.roomChatMsgIds[e.activatedRoom]),historyMsg:e.activatedRoom?e.roomHistoryMsgs[e.activatedRoom]:[],historyMsgSeq:e.activatedRoom?e.roomHistoryMsgSeqs[e.activatedRoom]:-1,channelFold:e.channelFold,owner:Ce(e.roomOwners,e.activatedRoom),user:e.user}})(Te),De=n(16),_e=(n(42),function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={expressways:[{id:"",title:"\u81ea\u52a9\u9000\u6362\u8d27",icon:"tuihuanhuo",desc:"",link:"//return.dangdang.com/reverseapplyselect.aspx"},{id:"",title:"\u81ea\u52a9\u8865/\u5408\u5f00\u53d1\u7968",icon:"fapiao",desc:"",link:"//order.dangdang.com/InvoiceApply/InvoiceOnlineReissue.aspx"},{id:"",title:"\u4fee\u6539/\u53d6\u6d88\u8ba2\u5355",icon:"dingdan",desc:"",link:"//myhome.dangdang.com/myOrder"},{id:"",title:"\u914d\u9001\u65f6\u6548",icon:"peisong",desc:"",link:"//help.dangdang.com/details/page400"},{id:"",title:"\u9000\u6362\u8d27\u529e\u7406\u65f6\u6548",icon:"shixiao",desc:"",link:"//help.dangdang.com/details/page217#p2"},{id:"",title:"\u67e5\u8be2\u9000\u6b3e",icon:"tuikuan",desc:"",link:"//help.dangdang.com/details/page31"},{id:"",title:"\u5b89\u5168\u4e2d\u5fc3",icon:"anquan",desc:"",link:"//safe.dangdang.com/safe.php"},{id:"",title:"\u793c\u54c1\u5361",icon:"lipinka",desc:"",link:"//newaccount.dangdang.com/payhistory/mymoney.aspx"},{id:"",title:"\u793c\u5238",icon:"liquan",desc:"",link:"//newaccount.dangdang.com/payhistory/mycoupon.aspx"}]},n}return Object(g.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"expressway",style:this.props.style},i.a.createElement("div",{className:""},i.a.createElement("ul",{className:"expressway-list"},this.state.expressways.map(function(e,t){return i.a.createElement("li",{className:"expressway-item",key:t},i.a.createElement("a",{href:e.link,target:"_blank"},i.a.createElement("img",{src:"http://static.dangdang.com/cim/public/images/"+e.icon+".png"}),i.a.createElement("p",null," ",e.title)))}))),i.a.createElement("div",{className:""}))}},{key:"handleClick",value:function(e){}},{key:"componentDidMount",value:function(){}}]),t}(c.Component)),xe=n(3),Pe=n.n(xe),Ae=(xe.Random.natural(1,999),xe.Random.cname(),xe.Random.natural(0,5),Pe.a.mock({tel:/1[35789]\d{9}/}).tel,xe.Random.natural(1,999),xe.Random.ctitle(3,50),xe.Random.image("84x84","#ffcc33","#FFF","png","\u5546\u54c1\u9884\u89c8"),xe.Random.natural(1,999),xe.Random.natural(0,5),[]),Le=0;Le<xe.Random.natural(1,10);Le++)Ae.push({id:"qid"+xe.Random.natural(1,999),title:xe.Random.ctitle(3,50),img:xe.Random.image("84x84","#ffcc33","#FFF","png","\u5546\u54c1\u9884\u89c8"),price:xe.Random.natural(1,999)});xe.Random.date("yyyy-MM-dd HH-mm-ss"),xe.Random.natural(0,9),xe.Random.cname(),xe.Random.natural(0,9999);var He=[];for(Le=0;Le<xe.Random.natural(0,10);Le++)He.push({id:"qid"+Le,date:xe.Random.date("yyyy-MM-dd HH-mm-ss"),status:xe.Random.natural(0,9),customer:xe.Random.cname(),money:xe.Random.natural(0,9999),products:Ae});var qe=[];for(Le=0;Le<xe.Random.natural(4,10);Le++)qe.push({id:"qid"+xe.Random.natural(1,999),seq:xe.Random.natural(1,999),text:xe.Random.csentence()});var Fe=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={},n}return Object(g.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.shop;return i.a.createElement("div",{ref:"shop",className:"shop",style:this.props.style},i.a.createElement("div",{className:"shop-main",style:{display:e.shopName?"block":"none"}},i.a.createElement("div",{className:"shop-info"},i.a.createElement("div",{className:"shop-name"},i.a.createElement("i",{className:"icon icon-shop".concat(e.shopId>0?"":"-ziying")}),e.shopName),i.a.createElement("div",{className:"shop-score"},"\u5e97\u94fa\u603b\u5206\uff1a",i.a.createElement("output",null,i.a.createElement("span",null,e.shopRating||"--"),"\u5206")),i.a.createElement("div",{className:"shop-tel"},"\u8054\u7cfb\u7535\u8bdd\uff1a",i.a.createElement("output",null,e.contact||"--"))),i.a.createElement("div",{className:"shop-rating"},i.a.createElement("table",null,i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null,"\u8bc4\u5206\u7ec6\u5219"),i.a.createElement("th",null,"\u4e0e\u540c\u884c\u4e1a\u76f8\u6bd4"))),i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",null,"\u63cf\u8ff0\u76f8\u7b26\uff1a",i.a.createElement("output",null,e.descriptionRating||"--"),i.a.createElement("i",{className:"icon"})),i.a.createElement("td",null,i.a.createElement("output",null,"\u540c\u6bd4",e.compDescriptionRating||"--","%"))),i.a.createElement("tr",null,i.a.createElement("td",null,"\u670d\u52a1\u6001\u5ea6\uff1a",i.a.createElement("output",null,e.serviceRating||"--"),i.a.createElement("i",{className:"icon"})),i.a.createElement("td",null,i.a.createElement("output",null,"\u540c\u6bd4",e.compServiceRating||"--","%"))),i.a.createElement("tr",null,i.a.createElement("td",null,"\u53d1\u8d27\u901f\u5ea6\uff1a",i.a.createElement("output",null,e.deliveryRating||"--"),i.a.createElement("i",{className:"icon"})),i.a.createElement("td",null,i.a.createElement("output",null,"\u540c\u6bd4",e.compDeliveryRating||"--","%")))))),i.a.createElement("div",{className:"shop-operation"},i.a.createElement("a",{href:"//shop.dangdang.com/".concat(e.shopId),target:"_blank",className:"btn-notice"},"\u8fdb\u5165\u5e97\u94fa"))),i.a.createElement("div",{className:"content-none",style:{display:e.shopName?"none":"block"}},i.a.createElement("img",{src:"http://static.dangdang.com/cim/public/images/none.png"}),i.a.createElement("p",null,"\u6682\u65f6\u6ca1\u6709\u5e97\u94fa\u4fe1\u606f\uff5e ")),i.a.createElement("div",{className:""}))}},{key:"handleClick",value:function(e){}},{key:"componentDidMount",value:function(){var e=Object(s.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),t}(c.Component);Fe.defaultProps={shop:{}};var Ue=function(e){function t(){return Object(u.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props.product;return i.a.createElement("div",{className:"product",style:this.props.style},i.a.createElement("div",{className:"product-main",style:{display:t.productId?"block":"none"}},i.a.createElement("div",{className:"product-item"},i.a.createElement("div",{className:"product-item-preview"},i.a.createElement("img",{src:t.headPortraitL})),i.a.createElement("div",{className:"product-item-info"},i.a.createElement("a",{className:"text-multipleLine",href:"//product.dangdang.com/".concat(t.productId,".html"),target:"_blank"},t.productName))),i.a.createElement("div",{className:"product-others"},i.a.createElement("div",{className:"product-price"},"\u62a2\u8d2d\u4ef7\uff1a",i.a.createElement("output",null,"\uffe5",t.salePrice||"--"))),i.a.createElement("div",{className:"product-operation"},i.a.createElement("span",{className:"btn-notice",onClick:function(){return window.open("//product.dangdang.com/".concat(t.productId,".html"),"_blank")}},"\u53bb\u8d2d\u4e70"),i.a.createElement("span",{className:"btn-notice",onClick:function(){return e.props.onSendMsg(7,{cardType:"product",bizId:t.productId||"",desc:t.productName,picUrl:t.headPortraitL,price:t.salePrice})}},"\u53d1\u9001"))),i.a.createElement("div",{className:"content-none",style:{display:t.productId?"none":"block"}},i.a.createElement("img",{src:"http://static.dangdang.com/cim/public/images/none.png"}),i.a.createElement("p",null,"\u6682\u65f6\u6ca1\u6709\u5546\u54c1\u4fe1\u606f\uff5e ")),i.a.createElement("div",{className:""}))}},{key:"handleClick",value:function(e){}},{key:"componentDidMount",value:function(){}}]),t}(c.Component);function Ge(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],new Date(e)),n=t.getFullYear(),a=t.getMonth()+1,o=t.getDate(),r=t.getHours(),s=t.getMinutes();return n+"-"+(a>9?a:"0"+a)+"-"+(o>9?o:"0"+o)+" "+(r>9?r:"0"+r)+":"+(s>9?s:"0"+s)}var We="";We="//return.dangdang.com/reverseapplydetail.aspx?apply_id=";var Je=function(e){function t(){return Object(u.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"order",style:this.props.style},i.a.createElement("div",{className:"order-main",style:{display:this.props.orders.length>0?"block":"none"}},i.a.createElement("ul",{ref:"ul",className:"order-list ".concat(this.props.isPanel?"order-list-panel":"")},this.props.orders.map(function(t,n){return i.a.createElement("li",{className:"order-item ".concat(e.props.isPanel?"order-item-fold":""),key:n},i.a.createElement("div",{className:"order-header",onClick:e.props.isPanel?function(t){e.togglePanel(n)}:function(){}},i.a.createElement("p",null,"order"===e.props.orderType?"\u8ba2\u5355":"\u7533\u8bf7\u5355","\u53f7\uff1a",i.a.createElement("a",{style:{display:"order"===e.props.orderType?"inline":"none"},href:"//order.dangdang.com/orderdetails.aspx?orderid="+t.orderId,target:"_blank"},t.orderId||"-----"),i.a.createElement("a",{style:{display:"reverse"===e.props.orderType?"inline":"none"},href:We+t.orderId,target:"_blank"},t.orderId||"-----"),"\xa0\xa0",Ge(t.orderCreationDate)),i.a.createElement("span",{className:"order-status order-status-".concat(t.orderStatus)},t.orderStatusName,i.a.createElement("i",{className:"icon"}))),i.a.createElement("div",{className:"order-body",style:{display:"nonex"}},i.a.createElement("ul",{className:"product-list"},Array.isArray(t.productList)&&t.productList.map(function(t,n){return i.a.createElement("li",{className:"product-item",key:n},i.a.createElement("div",{className:"product-item-preview"},i.a.createElement("img",{src:t.productPicture})),i.a.createElement("div",{className:"product-item-info"},i.a.createElement("a",{className:"text-multipleLine",href:"//product.dangdang.com/"+t.productId+".html",target:"_blank"},t.productName," ")),i.a.createElement("span",{className:"btn-default",onClick:function(){return e.props.onSendMsg(7,{cardType:"product",bizId:t.productId||"",desc:t.productName,picUrl:t.productPicture,price:t.salePrice})}},"\u53d1\u9001\u5546\u54c1"))})),i.a.createElement("div",{className:"order-customer"},i.a.createElement("span",{className:""},"\u8ba2\u5355\u91d1\u989d\uff1a",i.a.createElement("output",null,"\uffe5",void 0===t.total?"--":t.total)),i.a.createElement("span",{className:""},"\u6536\u8d27\u4eba\uff1a",i.a.createElement("output",null,t.receiverName||"--"))),i.a.createElement("div",{className:"order-operation"},i.a.createElement("span",{className:"btn-notice",onClick:function(){return e.props.onSendMsg(7,{cardType:e.props.orderType,bizId:t.orderId||"",orderDate:Ge(t.orderCreationDate),orderStatus:t.orderStatusName,price:t.total,picUrl:Array.isArray(t.productList)&&t.productList[0]?t.productList[0].productPicture:""})}},"\u53d1\u9001\u8ba2\u5355"))))}))),i.a.createElement("div",{className:"content-none",style:{display:this.props.orders.length>0?"none":"block"}},i.a.createElement("img",{src:"http://static.dangdang.com/cim/public/images/none.png"}),i.a.createElement("p",null,"\u6682\u65f6\u8fd8\u6ca1\u6709\u8ba2\u5355\u54e6\uff5e ")))}},{key:"togglePanel",value:function(e){console.log("toggle panel index:",e);var t=this.refs.ul.getElementsByClassName("order-item")[e],n=t.className.includes("order-item-fold");t.className=n?"order-item":"order-item order-item-fold"}},{key:"componentDidMount",value:function(){var e=Object(s.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),t}(c.Component);Je.defaultProps={isPanel:!1,orderType:"order",orders:[]};var Ve=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={},n}return Object(g.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props.questions;return i.a.createElement("div",{className:"question",style:this.props.style},i.a.createElement("div",{className:"",style:{display:this.props.questions.length>0?"block":"none"}},i.a.createElement("ul",{className:"question-list"},t.map(function(t,n){return i.a.createElement("li",{className:"question-item",key:n,onClick:function(){e.props.onSendMsg(1,t)}},n+1+"."+t)}))),i.a.createElement("div",{className:"content-none",style:{display:this.props.questions.length>0?"none":"block"}},i.a.createElement("img",{src:"http://static.dangdang.com/cim/public/images/none.png"}),i.a.createElement("p",null,"\u6682\u65f6\u8fd8\u6ca1\u6709\u5e38\u89c1\u95ee\u9898\u54e6\uff5e ")))}},{key:"handleClick",value:function(e){}},{key:"componentDidMount",value:function(){}}]),t}(c.Component);function Ye(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,n=void 0===t?"":t,a=(e.isLog,e.style),o=void 0===a?"":a;return!1?function(){var e,t=Array.prototype.slice.call(arguments);console.log("%c----"+n+":"+t.shift()+"----",o),t.length>0&&(e=console).log.apply(e,Object(De.a)(t))}:function(){}}Ve.defaultProps={questions:[]};Ye({name:"DELOG",isLog:!0,style:"color:#f00"});function Qe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,n=void 0===t?"":t,a=(e.isDebug,e.style),o=void 0===a?"":a;return!1?console.log.bind(this,"%c"+n+"::",o):function(){}}Qe({name:"DELOG",isDebug:!0,style:"color:#f00"}),Qe({name:"CHANNEL",isDebug:!1,style:"color:#f00"});var Xe=Ye({name:"CHANNEL",isLog:!1,style:"color:#f00"}),ze=[{id:"1005",name:"order",value:"\u6700\u8fd1\u8ba2\u5355",label:"\u6700\u8fd1\u8ba2\u5355",desc:""},{id:"1001",name:"expressway",value:"\u5feb\u6377\u901a\u9053",label:"\u5feb\u6377\u901a\u9053",desc:""},{id:"1003",name:"question",value:"\u5e38\u89c1\u95ee\u9898",label:"\u5e38\u89c1\u95ee\u9898"},{id:"1004",name:"shop",value:"\u5e97\u94fa\u4fe1\u606f",label:"\u5e97\u94fa\u4fe1\u606f"}],Be=function(e){function t(e){var n;Object(u.a)(this,t);return(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={navs:ze,activatedNav:"1005",navScrollIndex:0,navScrollStep:3},n}return Object(g.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this;Xe("render");var t=this.props,n=(t.dispatch,t.sourcePage),a=t.order,o=t.product,r=t.shop,s=t.questions,c=t.recentOrders,l=this.state.navs;return i.a.createElement("div",{id:"channel",className:"channel",style:this.props.style},i.a.createElement("div",{className:"channel-nav"},i.a.createElement("span",{className:"channel-nav-prev",style:{display:l.length>this.state.navScrollStep?"block":"none",cursor:0==this.state.navScrollIndex?"not-allowed":"pointer"},onClick:function(){e.scrollNav("prev")}},i.a.createElement("i",{className:"icon"})),i.a.createElement("ul",{className:"channel-nav-list"},Object(De.a)(l).splice(this.state.navScrollIndex,this.state.navScrollStep).map(function(t){return i.a.createElement("li",{className:"channel-nav-item ".concat(e.state.activatedNav===t.id?"channel-nav-item-activated":""),key:t.id,onClick:function(){e.setState({activatedNav:t.id})}},t.label)})),i.a.createElement("span",{className:"channel-nav-next",style:{display:l.length>this.state.navScrollStep?"block":"none",cursor:this.state.navScrollIndex>=l.length-this.state.navScrollStep?"not-allowed":"pointer"},onClick:function(){e.scrollNav("next")}},i.a.createElement("i",{className:"icon"}))),i.a.createElement("div",{className:"channel-main"},"product"===n&&i.a.createElement(Ue,{style:{display:"1000"===this.state.activatedNav?"block":"none"},product:o,onSendMsg:function(t,n){return e.handleSendMsg(t,n)}}),("order"===n||"reverse"===n)&&i.a.createElement(Je,{style:{display:"1000"===this.state.activatedNav?"block":"none"},orders:[a],key:"1000",orderType:n,onSendMsg:function(t,n){return e.handleSendMsg(t,n)}}),i.a.createElement(Je,{style:{display:"1005"===this.state.activatedNav?"block":"none"},isPanel:!0,orders:c,key:"1005",onSendMsg:function(t,n){return e.handleSendMsg(t,n)}}),i.a.createElement(_e,{style:{display:"1001"===this.state.activatedNav?"block":"none"}}),i.a.createElement(Fe,{style:{display:"1004"===this.state.activatedNav?"block":"none"},shop:r}),i.a.createElement(Ve,{style:{display:"1003"===this.state.activatedNav?"block":"none"},questions:s,onSendMsg:function(t,n){e.handleSendMsg(t,n)}})),i.a.createElement("div",{className:"channel-"}))}},{key:"handleSendMsg",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this.props,a=n.dispatch,o=n.roomId,r=n.owner;if(r&&0==r.status){if(!o)return alert("\u8bf7\u5148\u9009\u62e9\u8981\u54a8\u8be2\u7684\u5e97\u94fa\u3002");1!=e&&(t=JSON.stringify(t));var s=(new Date).getTime();ge(s),a(oe(s,{msgId:s,msgType:e,msgStatus:"loading",senderType:1,content:t})),a(ae(o,[s])),ve(s),Me.sendMsg(o,6,s,e,t)}}},{key:"scrollNav",value:function(e){var t=this.state.navScrollIndex,n=this.state.navs.length-this.state.navScrollStep;if("next"==e){if(t>n)return;t+=this.state.navScrollStep}if("prev"==e){if(t=0)return;t-=this.state.navScrollStep}t>n&&(t=n),t<0&&(t=0),this.setState({navScrollIndex:t})}},{key:"componentDidMount",value:function(){var e=Object(s.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e,t,n){if(e.sourcePage!=this.props.sourcePage)if("order"===this.props.sourcePage||"reverse"===this.props.sourcePage||"product"===this.props.sourcePage){var a="";"order"===this.props.sourcePage||"reverse"===this.props.sourceContent&&(a="order"),"product"===this.props.sourcePage&&(a="product"),this.setState({navs:[{id:"1000",name:a,value:"\u6b63\u5728\u54a8\u8be2",label:"\u6b63\u5728\u54a8\u8be2",desc:""}].concat(ze),activatedNav:"1000",navScrollIndex:0})}else{var o="1005";"shop"===this.props.sourcePage&&(o="1004"),this.setState({navs:ze,activatedNav:o,navScrollIndex:1})}}}]),t}(c.Component);function Ke(e){var t;return e&&(t=e.sourcePage),t||""}function Ze(e,t){var n;return t&&(n=e[t]),n||{}}function $e(e,t){var n;return t&&(n=e[t.sourceContent]),Object(r.a)({productList:[]},n)}function et(e,t){var n;return t&&(n=e[t.sourceContent]),n||{}}function tt(e,t){var n;return t&&(n=e[t]),n||[]}function nt(e,t){var n;return t&&(n=e[t]||{}),Object(r.a)({status:-1,userType:-1,star:0},n)}Be.defaultProps={sourcePage:""};var at=Object(d.b)(function(e){return{activatedChannel:e.activatedChannel,sourcePage:Ke(e.rooms[e.activatedRoom]),shop:Ze(e.roomShops,e.activatedRoom),questions:tt(e.roomQuestions,e.activatedRoom),order:$e(e.orders,e.rooms[e.activatedRoom]),product:et(e.products,e.rooms[e.activatedRoom]),recentOrders:e.recentOrders||[],roomId:e.activatedRoom,owner:nt(e.roomOwners,e.activatedRoom)}})(Be),ot=(n(43),function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={isFilterRoom:!1},n.handleFilterRoom=n.handleFilterRoom.bind(Object(v.a)(n)),n}return Object(g.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{id:"roomList",className:"roomList"},i.a.createElement("div",{className:"room-serach"},i.a.createElement("input",{ref:"input",placeholder:"\u641c\u7d22\u6700\u8fd1\u8054\u7cfb\u4eba",onFocus:function(){return e.setState({isFilterRoom:!0})},onBlur:function(){e.refs.input.value.lenth<1&&e.setState({isFilterRoom:!1})},onChange:A()(this.handleFilterRoom,800)}),i.a.createElement("i",{className:"icon",style:{display:this.state.isFilterRoom?"block":"none"},onClick:function(){e.handleClearRoomFilter()}})),i.a.createElement("ul",{className:"room-list"},this.props.rooms.map(function(t,n){return i.a.createElement("li",{className:"room-item text-oneLine ".concat(t.roomId==e.props.activated?"room-item-activated":""),key:t.roomId,roomid:t.roomId,shopid:t.shopId,onClick:function(n){e.props.onSetActivatedRoom(t.roomId)}},i.a.createElement("output",{style:{display:t.unreadCount>0?"block":"none"}},t.unreadCount),i.a.createElement("img",{src:t.shopPortrait}),t.shopName,i.a.createElement("i",{className:"icon room-item-close",onClick:function(n){n.stopPropagation(),e.props.onDeleteRoom(t.roomId)}}))})))}},{key:"handleClearRoomFilter",value:function(){this.refs.input.value="",this.props.onFilterRoom(""),this.setState({isFilterRoom:!1})}},{key:"handleFilterRoom",value:function(e){var t=this.refs.input.value.trim();this.props.onFilterRoom(t)}},{key:"componentDidMount",value:function(){}}]),t}(c.Component)),rt=function(e){function t(){return Object(u.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.owner;return i.a.createElement("div",{className:"roomOwner"},i.a.createElement("img",{src:e.portraitUrl}),i.a.createElement("span",{className:"user-name"},e.nickname),i.a.createElement("span",{className:"user-star"},new Array(e.star).fill(0).map(function(e,t){return i.a.createElement("i",{className:"icon icon-star icon-star-gold",key:t})}),new Array(5-e.star).fill(0).map(function(e,t){return i.a.createElement("i",{className:"icon  icon-star icon-star-gray",key:t})})))}},{key:"handleClick",value:function(e){}},{key:"componentDidMount",value:function(){}}]),t}(c.Component);rt.defaultProps={owner:{nickname:"\u5f53\u524d\u65e0\u5ba2\u670d",portraitUrl:"http://static.dangdang.com/cim/public/images/kefu.png",star:0,userType:3,status:-1}};n(44);var st=function(){},ct=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={comments:[{label:"\u8d85\u8d5e",img:"chaozan",degree:5},{label:"32\u4e2a\u8d5e",img:"32zan",degree:4},{label:"\u51d1\u5408",img:"couhe",degree:3},{label:"\u5410\u69fd",img:"tucao",degree:2},{label:"\u5dee\u8bc4",img:"chaping",degree:1}],rewards:[{label:"\u6da6\u5589\u7cd6",img:"runhoutang",value:10,type:1},{label:"\u6ef4\u773c\u6db2",img:"diyanye",value:30,type:2},{label:"\u80d6\u5927\u6d77",img:"pangdahai",value:50,type:3},{label:"\u591a\u8089\u690d\u7269",img:"duorou",value:100,type:4},{label:"\u5496\u5561",img:"kafei",value:200,type:5}],commentDegree:5,rewardType:1,commentNote:"",rewardStep:4,rewardMove:0},n}return Object(g.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.rewards,a=t.rewardMove,o=t.rewardStep;return i.a.createElement("div",{className:"comment"},i.a.createElement("div",{className:"comment-header"},"\u670d\u52a1\u8bc4\u4ef7",i.a.createElement("i",{className:"icon",onClick:function(){e.props.onCancel(!1)}})),i.a.createElement("div",{className:"comment-body"},i.a.createElement("p",null,"\u8bf7\u60a8\u5bf9\u5ba2\u670d\u7684\u670d\u52a1\u7ed9\u4e88\u8bc4\u4ef7"),i.a.createElement("ul",{className:"comment-list"},this.state.comments.map(function(t,n){return i.a.createElement("li",{className:"comment-item comment-item-".concat(t.degree==e.state.commentDegree?"activated":""),key:n,onClick:function(){return e.setState({commentDegree:t.degree})}},i.a.createElement("img",{src:"".concat("http://static.dangdang.com/cim/public","/images/").concat(t.img).concat(t.degree==e.state.commentDegree?"":"_gray",".png")}),i.a.createElement("p",null,i.a.createElement("span",{className:"radio-default ".concat(t.degree==e.state.commentDegree?"radio-default-checked":"")}),t.label))})),i.a.createElement("div",{className:"comment-good",style:{display:this.state.commentDegree>3?"block":"none"}},i.a.createElement("div",null,"\u975e\u5e38\u6ee1\u610f\uff0c\u582a\u79f0\u5b8c\u7f8e\uff0c\u9009\u4e2a\u793c\u7269\u9001\u7ed9\u4f60\uff5e"),i.a.createElement("p",null,"\u53ef\u7528\u94f6\u94c3\u94db\uff1a",this.props.points||0),i.a.createElement("div",{className:"rewards"},i.a.createElement("span",{className:"reward-move reward-move-prev ".concat(0==a?"reward-move-disabled":""),style:{display:n.length>this.state.rewardStep},onClick:function(){e.moveReward("prev")}},i.a.createElement("i",{className:"icon icon-lt"})),i.a.createElement("ul",{className:"reward-list"},Object(De.a)(n).splice(a,o).map(function(t,n){return i.a.createElement("li",{className:"reward-item ".concat(e.state.rewardType===t.type?"reward-item-checked":""),key:n,onClick:function(){e.handelRewardType(t.type)}},i.a.createElement("img",{src:"".concat("http://static.dangdang.com/cim/public","/images/")+t.img+".png"}),i.a.createElement("p",null,t.label),i.a.createElement("div",{className:"reward-value"},t.value,"\u94f6\u94c3\u94db"),i.a.createElement("i",{className:"icon"}))})),i.a.createElement("span",{className:"reward-move reward-move-next ".concat(a+o>=n.length?"reward-move-disabled":""),style:{display:n.length>this.state.rewardStep},onClick:function(){e.moveReward("next")}},i.a.createElement("i",{className:"icon"})))),i.a.createElement("div",{className:"comment-nogood",style:{display:this.state.commentDegree>3?"none":"block"}},i.a.createElement("textarea",{value:this.state.commentNote,maxLength:"60",placeholder:"\u5176\u4ed6\u5efa\u8bae\u53ca\u53cd\u9988\uff0c\u8bf7\u5728\u6b64\u5904\u7559\u8a00",onChange:function(t){e.handleChangeCommentNote(t)}}),i.a.createElement("span",null,i.a.createElement("output",{style:{color:0==this.state.commentNote.length?"#989898":"#323232"}},this.state.commentNote.length),"/60")),i.a.createElement("div",{className:"comment-operation"},i.a.createElement("span",{className:"btn-default",onClick:function(){e.props.onCancel(!1)}},"\u53d6\u6d88"),i.a.createElement("span",{className:"btn-notice",onClick:function(){e.handleAppraiseKefu()}},"\u786e\u5b9a"))),i.a.createElement("div",{className:""}))}},{key:"moveReward",value:function(e){var t,n=this.state,a=n.rewards,o=n.rewardMove,r=n.rewardStep,s=a.length-r;if("prev"===e){if(0==o)return;(t=o-r)<0&&(t=0)}if("next"===e){if(o>=s)return;(t=o+r)>s&&(t=s)}this.setState({rewardMove:t})}},{key:"handelRewardType",value:function(e){e=e==this.state.rewardType?"":e,this.setState({rewardType:e})}},{key:"handleAppraiseKefu",value:function(){var e=Object(s.a)(o.a.mark(function e(){var t,n,a,r,s,c,i,l,d,u,m,p=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props,n=t.points,a=t.onHandleSubmitComment,r=this.state,s=r.rewards,c=r.rewardType,i=r.commentDegree,d=0,!(l=!!(i>3&&c))){e.next=9;break}if(u=s.filter(function(e){return e.type==c})[0],d=u?u.value:0,!(n<d)){e.next=9;break}return e.abrupt("return",alert("\u5f53\u524d\u94c3\u94db\u6570\u91cf\u4e0d\u8db3\u3002\u8bf7\u91cd\u65b0\u9009\u62e9"));case 9:m=this.state.commentNote,a({commentDegree:i,isReward:l,rewardType:c,rewardValue:d,commentNote:m}).then(function(){p.setState({commentDegree:5,rewardType:1,commentNote:""})});case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"handleChangeCommentNote",value:function(e){this.setState({commentNote:e.target.value})}},{key:"componentDidMount",value:function(){st("Comment did mount")}}]),t}(c.Component),it=(Qe({name:"APP",isDebug:!0,style:"color:#f00"}),Ye({name:"APP",isLog:!0,style:"color:#f00"})),lt=function(e){function t(){return Object(u.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=(t.dispatch,t.user,t.points),a=t.roomOwner,o=t.activatedRoom,r=t.roomList,s=t.channelFold,c=t.isShowComment;return i.a.createElement("div",{id:"cimp"},i.a.createElement("div",{className:"main"},i.a.createElement(ot,{rooms:r,activated:o,onSetActivatedRoom:function(t){e.handleSetActivatedRoom(t)},onDeleteRoom:function(t){e.handleDeleteRoom(t)},onFilterRoom:function(t){e.handleFilterRoom(t)}}),i.a.createElement("div",{className:"line-divide-col"}),i.a.createElement("div",{className:"container"},i.a.createElement("div",{className:"container-header"},i.a.createElement(rt,{owner:a}),i.a.createElement("div",{className:"winStatus"},i.a.createElement("i",{className:"icon",onClick:function(){e.handleDisplayIMC("mini")}}),i.a.createElement("i",{className:"icon",onClick:function(){e.handleDisplayIMC("closed")}}))),i.a.createElement("div",{className:"container-body"},i.a.createElement(je,{onHandleOpenComment:function(){return e.handleOpenComment()}}),i.a.createElement(at,{style:{display:"unfold"==s?"block":"none"}}))),i.a.createElement("div",{className:""}),i.a.createElement("div",{className:"test"})),["START","DEVLOP","3NDTEST","STAGEx"].includes("ONLINE")&&i.a.createElement("div",{className:"footer"},i.a.createElement("input",{ref:"sid",placeholder:"\u8bf7\u8f93\u5165sessionId",defaultValue:"pc_1c9d5c2e6d2dc49ac4b5d294b83e30e3a5f97a7ab8f46cac82dc670209e4e9f1"}),i.a.createElement("button",{title:"",onClick:function(){var t=e.refs.sid.value;window.postMessage({type:"sessionId",data:t})}},"\u767b\u5f55IM"),i.a.createElement("button",{title:"\u5546\u94fa\u5165\u53e3\u3002\u65e0\u6b63\u5728\u54a8\u8be2\u3002",shopid:"9001",onClick:function(){window.postMessage({type:"entry",data:{sourcePage:"shop",shopId:"9001",ddShopId:"0"}})}},"S-9001 "),i.a.createElement("button",{title:"ST-\u7279\u6b8a\u81ea\u8425",shopid:"0",onClick:function(){window.postMessage({type:"entry",data:{sourcePage:"shop",shopId:"0",ddShopId:"369"}})}},"S-0-369 "),i.a.createElement("button",{title:"ST-\u5546\u94fa\u5165\u53e3\u3002\u65e0\u6b63\u5728\u54a8\u8be2\u3002",shopid:"0",onClick:function(){window.postMessage({type:"entry",data:{sourcePage:"shop",shopId:"7000",ddShopId:"0"}})}},"S-7000-369 "),i.a.createElement("button",{title:"\u4ea7\u54c1\u5165\u53e3\u3002\u6dfb\u52a0\u6b63\u5728\u54a8\u8be2",shopid:"9001",onClick:function(){window.postMessage({type:"entry",data:{sourcePage:"product",shopId:"0",ddShopId:"0",sourceContent:"22554450"}})}},"P-0-p1"),i.a.createElement("button",{title:"\u4ea7\u54c1\u5165\u53e3\u3002\u6dfb\u52a0\u6b63\u5728\u54a8\u8be2",shopid:"9001",onClick:function(){window.postMessage({type:"entry",data:{sourcePage:"product",shopId:"9001",ddShopId:"0",sourceContent:"1078490624"}})}},"P-9001-p1"),i.a.createElement("button",{title:"\u9000\u6362\u8d27\u5165\u53e3\u3002\u6dfb\u52a0\u6b63\u5728\u54a8\u8be2",onClick:function(){window.postMessage({type:"entry",data:{sourcePage:"reverse",shopId:"9001",ddShopId:"0",sourceContent:"342294189"}})}},"R-9001-r1"),i.a.createElement("button",{title:"\u9000\u6362\u8d27\u5165\u53e3\u3002\u76f8\u540c9001\u5546\u94fa\uff0c\u663e\u793a\u4e0d\u540c\u8ba2\u5355",onClick:function(){window.postMessage({type:"entry",data:{sourcePage:"reverse",shopId:"9001",ddShopId:"0",sourceContent:"342294169"}})}},"R-9001-r2"),i.a.createElement("button",{title:"\u8ba2\u5355\u5165\u53e3\u3002\u6dfb\u52a0\u6b63\u5728\u54a8\u8be2",onClick:function(){window.postMessage({type:"entry",data:{sourcePage:"order",shopId:"0",ddShopId:"0",sourceContent:"1013037761199"}})}},"O-0-o1"),i.a.createElement("button",{title:"\u8ba2\u5355\u5165\u53e3\u3002\u663e\u793a\u4e0d\u540c\u5546\u94fa",onClick:function(){window.postMessage({type:"entry",data:{sourcePage:"order",shopId:"9001",ddShopId:"0",sourceContent:"1013037761639"}})}},"O-9001-o1"),i.a.createElement("br",null)),i.a.createElement("div",{className:"mask",style:{display:c?"block":"none"}},i.a.createElement("div",{className:"mask-main"},i.a.createElement(ct,{className:"test",points:n,onHandleSubmitComment:function(t){return e.handleSubmitComment(t)},onCancel:function(t){e.closeComment(t)}}))))}},{key:"handleDeleteRoom",value:function(e){var t=this.props,n=t.dispatch,a=t.roomVisibleIds,o=t.activatedRoom;if(n(ce(a.filter(function(t){return t!=e}))),e==o){var r=a.findIndex(function(t){return t==e});0==r&&(r=1),r<0&&(r=0),n(le(a[r])),Me.sendMsg(e,11,(new Date).getTime())}}},{key:"handleFilterRoom",value:function(e){var t=this.props,n=t.dispatch,a=t.allRooms,o=[];Object.keys(a).map(function(t){(a[t].shopName||"").includes(e)&&o.push(t)}),n(ce(o))}},{key:"handleSetActivatedRoom",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n,a,s,c,i,l,d,u,m,p,h,g,v,f,y,b,E;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.props,a=n.dispatch,s=n.user,c=n.activatedRoom,i=n.allRooms,l=n.allOwners,d=n.allShops,fe(t),ye(t),u=i[t]||{},s.sessionId,m=u.shopId,p=u.ddShopId,h=u.sourcePage,g=u.sourceContent,d[t]){e.next=11;break}return e.next=9,N({shopId:m,ddShopId:p,sourcePage:h});case 9:(f=e.sent).data&&(v=Object(r.a)({shopName:"\u5e97\u94fa\u540d",shopPortrait:"",shopId:m,ddShopId:p},f.data),a(Z(t,v)));case 11:if(be(t,m,p),Ee(h,g),y=(new Date).getTime(),u.unreadCount,l[t]||(E={star:0,nickname:"\u5f53\u524d\u672a\u8fde\u63a5\u5ba2\u670d",portraitUrl:"http://static.dangdang.com/cim/public/images/kefu.png",userType:-1,status:-1},b={msgType:"joinRoom",senderType:3,content:Object(r.a)({},u)},a(K(t,E)),a(oe(y+1,b)),a(ae(t,[y+1]))),a(le(t)),a(B(t,{unreadCount:0})),u.isComment&&(a(me(!0)),a(B(t,{isComment:0}))),Me.sendMsg(t,26,(new Date).getTime()),c){e.next=23;break}return e.abrupt("return");case 23:Me.sendMsg(c,11,(new Date).getTime());case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"closeComment",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.props,n=t.dispatch,a=t.activatedRoom,o=t.allRooms;n(me(e)),1==o[a].isComment&&n(B(a,{isComment:0}))}},{key:"handleSubmitComment",value:function(){var e=Object(s.a)(o.a.mark(function e(){var t,n,a,s,c,i,l,d,u,m,p,h=arguments;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.length>0&&void 0!==h[0]?h[0]:{},n=this.props,a=n.dispatch,s=n.user,c=n.points,i=n.roomOwner,l=n.activatedRoom,i){e.next=4;break}return e.abrupt("return");case 4:if((d=i.userId)&&2==i.userType){e.next=7;break}return e.abrupt("return",alert("\u5f53\u524d\u5ba2\u670d\u4e0d\u652f\u6301\u6253\u8d4f\u529f\u80fd\uff01"));case 7:return e.next=9,D(Object(r.a)({},t,{staffCustId:d,roomId:l,token:s.sessionId}));case 9:if((u=e.sent).data){e.next=12;break}return e.abrupt("return",alert("\u63d0\u4ea4\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\u3002"));case 12:return m=t.isReward,p=t.rewardValue,m&&a(ue(c-p)),e.abrupt("return",new Promise(function(e,t){return e(u)}));case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"handleOpenComment",value:function(){var e=Object(s.a)(o.a.mark(function e(){var t,n,a,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props,n=t.dispatch,a=t.user,r=t.roomOwner,a.sessionId){e.next=4;break}return e.abrupt("return",alert("\u8bf7\u5148\u767b\u5f55\uff01"));case 4:if(1!=r.hasCommented){e.next=6;break}return e.abrupt("return");case 6:if(2==r.userType){e.next=8;break}return e.abrupt("return");case 8:if(1!=r.status){e.next=10;break}return e.abrupt("return");case 10:n(me(!0));case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"handleDisplayIMC",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"mini",t=this.props,n=t.dispatch,a=t.allRooms,o=t.activatedRoom,r="IMNDisplay";"closed"===e&&(r="IMCClose"),Se({type:r,data:a[o]}),n(pe(e)),Me.sendMsg(o,11,(new Date).getTime())}},{key:"componentDidMount",value:function(){var e=Object(s.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:it("componentDidMount");case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),t}(c.Component),dt=function(e,t){var n=[];return t.map(function(t){var a=e[t];a&&n.push(a)}),n};var ut=Object(d.b)(function(e){return{user:e.user,points:e.points,roomOwner:e.roomOwners[e.activatedRoom]||{nickname:"\u672a\u9009\u62e9\u623f\u95f4",portraitUrl:"http://static.dangdang.com/cim/public/images/kefu.png",status:-1,userType:-1,star:0},activatedRoom:e.activatedRoom,roomList:dt(e.rooms,e.roomVisibleIds),allRooms:e.rooms,roomVisibleIds:e.roomVisibleIds,allOwners:e.roomOwners,allShops:e.roomShops,channelFold:e.channelFold,isShowComment:e.isShowComment}})(lt);n(45),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));Qe({name:"INDEX",isDebug:!0,style:"color:#f00"});var mt=Ye({name:"INDEX",isLog:!0,style:"color:#f00"}),pt=["product.dangdang.com","myhome.dangdang.com","shopping.dangdang.com","customer.dangdang.com","newreturn.dangdang.com","shop.dangdang.com"];pt.push("cim.dangdang.com"),pt.push("returnlocal.dangdang.com");var ht=null,gt={};function vt(e){var t=z.getState().roomVisibleIds;t.some(function(t){return t==e})||z.dispatch(ce([e].concat(t)))}function ft(e,t,n){var a=(z.getState().roomHistoryMsgSeqs||{})[e]||0,o=n[e]||[];if(0==a)for(var r=0;r<o.length;r++){var s=t[o[r]];if(s&&s.seq>0)return void z.dispatch(te(e,s.seq))}}function yt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;ge(e);var o=n.userType,s=n.userId,c=n.hasRobot,i=n.hint,l=(n.isFirstEntry,n.status||0),d={star:0,nickname:"\u5f53\u524d\u672a\u8fde\u63a5\u5ba2\u670d",status:l,userType:o,userId:s,hasRobot:c,portraitUrl:"".concat("http://static.dangdang.com/cim/public","/images/kefu.png")};if(3==o&&(0==l&&(d=Object(r.a)({},d,{nickname:"\u667a\u80fd\u5ba2\u670d",portraitUrl:"".concat("http://static.dangdang.com/cim/public","/images/robot.png"),status:0}),Et(e,t,"\u667a\u80fd\u5ba2\u670d\u5df2\u63a5\u901a")),-1==l&&"string"===typeof i&&Et(e,t,i)),2==o&&0==l){d=Object(r.a)({},d,{nickname:"\u5728\u7ebf\u5ba2\u670d"},a),Et(e,t,"\u4eba\u5de5\u5ba2\u670d\u5df2\u63a5\u901a");var u={msgType:"rengong",senderType:"system",content:d};z.dispatch(oe(e+1,u)),z.dispatch(ae(t,[e+1])),z.dispatch(B(t,{isComment:0})),d.hasCommented=0}2==o&&1==l&&(d=Object(r.a)({},d,{nickname:"\u6b63\u5728\u6392\u961f..."})),o||(3==l&&(d=Object(r.a)({},d,{nickname:"\u5f53\u524d\u65e0\u53ef\u7528\u5ba2\u670d"}),Et(e,t,"\u5f53\u524d\u65e0\u53ef\u7528\u5ba2\u670d")),2==l&&"string"===typeof i&&Et(e,t,i),4==l&&Et(e,t,"\u79bb\u7ebf\u72b6\u6001\u4e0d\u80fd\u8054\u7cfb\u5ba2\u670d\u3002\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u65b0\u767b\u5f55")),z.dispatch(K(t,d))}function bt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=n.current,r=(n.totalCount,n.estimatedWaitTime,a.hasRobot);if(o){var s="\u5f53\u524d\u5ba2\u670d\u7e41\u5fd9\uff0c\u524d\u9762\u6709"+o+"\u4f4d\u7528\u6237\u6392\u961f\uff0c\u8bf7\u60a8\u8010\u5fc3\u7b49\u5019\uff0c\u8c22\u8c22",c={msgType:"command",content:{command:21,desc:s,title:"\u653e\u5f03\u6392\u961f"}};1==r&&(c={msgType:"command",content:{command:22,desc:s,title:"\u56de\u5230\u673a\u5668\u4eba"}}),z.dispatch(oe(e,c)),z.dispatch(ae(t,[e]))}}function Et(e,t,n){var a={msgType:"notify",senderType:"system",content:n};z.dispatch(oe(e,a)),z.dispatch(ae(t,[e]))}function It(e,t,n,a){ge(e),function(e,t,n){if(!t||!e||e==n)return;var a=t.unreadCount||0;a++,z.dispatch(B(e,{unreadCount:a}))}(t,n,a),function(e){"normal"!==z.getState().IMCStatus&&e&&Se({type:"newMsg",data:e})}(n)}window.addEventListener("message",function(){var e=Object(s.a)(o.a.mark(function e(t){var n,a,s,c,i,l,d,u,m,p,h,g,v,f,y;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.origin.includes("dangdang.com")){e.next=2;break}return e.abrupt("return");case 2:if(!(n=t.data).payload){e.next=5;break}return e.abrupt("return");case 5:if(!n.source){e.next=7;break}return e.abrupt("return");case 7:mt("IMP window onmessage",t),a=n.type,s=n.data,c=z.getState().user,i=z.getState().activatedRoom,l=z.getState().rooms,d=z.getState().roomOwners,c.sessionId,u=(new Date).getTime(),e.t0=a,e.next="sessionId"===e.t0?18:"entry"===e.t0?27:"IMCDisplay"===e.t0?35:38;break;case 18:return s||mt("\u5f53\u524d\u6ca1\u6709\u7528\u6237\u767b\u5f55"),e.next=21,C({sessionId:s});case 21:return"object"===typeof(p=e.sent).data&&(m=Object(r.a)({nickname:"\u65e0\u6635\u79f0\u7528\u6237",portraitUrl:"".concat("http://static.dangdang.com/cim/public","/images/user.png")},p.data,{sessionId:s})),z.dispatch(ie(m)),Me.setConnection(s),e.abrupt("break",38);case 27:return h=s.shopId,g=s.ddShopId,v=s.sourcePage,f=s.sourceContent,Ee(v,f),mt("ENTRY:all rooms",l),mt("ENTRY:entry",s),y=!1,Object.keys(l).map(function(e){var t=l[e];if(h==t.shopId&&g==t.ddShopId){mt("ENTRY:room had exit"),y=!0,Se({type:"roomReady"}),vt(e),v===t.sourcePage&&f===t.sourceContent||(mt("ENTRY:source change"),z.dispatch(B(e,s)));var n=d[e];n&&-1!=n.status?z.dispatch(le(e)):Me.joinRoom(t)}}),y||(mt("ENTRY:room does not exit"),gt[u]=Object(r.a)({msgId:u},s),Me.joinRoom(gt[u])),e.abrupt("break",38);case 35:return z.dispatch(pe("normal")),i&&Me.sendMsg(i,26,u),e.abrupt("break",38);case 38:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Me.onHandleMsg=function(){var e=Object(s.a)(o.a.mark(function e(t){var n,a,s,c,i,l,d,u,m,p,h,g,v,f,y,b,E,I,O,w,M,R,C,j,D,_,x,P,A,L,H,q,F,U,G,W;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:mt("onHandleMsg",t),n=t.command,a=t.roomId,s=t.msgId,c=t.queue,i=t.sessionResp,l=t.user,d=t.withdraw,u=t.text,m=z.getState().user,p=z.getState().rooms,h=z.getState().roomOwners,g=z.getState().activatedRoom,v=z.getState().chatMsgs||{},f=z.getState().roomChatMsgIds||{},y=m.sessionId,b=p[a],E=h[a]||{},I=(new Date).getTime(),e.t0=n,e.next="opened"===e.t0?15:"closed"===e.t0?17:"error"===e.t0?21:"Err-setConnection"===e.t0?22:"Err-joinRoom"===e.t0?23:"Err-sendMsg"===e.t0?25:2===e.t0?27:4===e.t0?46:5===e.t0?67:6===e.t0?73:7===e.t0?81:9===e.t0?86:12===e.t0?92:16===e.t0?92:10===e.t0?96:14===e.t0?99:17===e.t0?100:24===e.t0?104:18===e.t0?109:20===e.t0?110:23===e.t0?111:25===e.t0?114:26===e.t0?120:90===e.t0?121:99===e.t0?122:126;break;case 15:return Se({type:"IMSStatus",data:1}),e.abrupt("break",126);case 17:return Se({type:"IMSStatus",data:0}),clearInterval(ht),ht=null,e.abrupt("break",126);case 21:case 22:return e.abrupt("break",126);case 23:return Se({type:"info",data:u}),e.abrupt("break",126);case 25:return alert(u),e.abrupt("break",126);case 27:if(100!=t.res.errCode){e.next=31;break}return Se({type:"info",data:"\u767b\u5f55\u5f02\u5e38\uff01\u8bf7\u9000\u51fa\u9875\u9762\u91cd\u65b0\u767b\u5f55"}),window.top===top&&alert("\u767b\u5f55\u5f02\u5e38\uff01\u8bf7\u91cd\u65b0\u767b\u5f55"),e.abrupt("return");case 31:return Se({type:"IMSStatus",data:2}),w=[],e.next=35,S({sessionId:y});case 35:return(M=e.sent).data&&(w=M.data.custMsgOfShops||[]),z.dispatch(se(w)),z.dispatch(ie({usrId:t.userId})),R=[],w.forEach(function(e){e.ddShopId=e.ddshopId,R.push(e.roomId)}),z.dispatch(ce(R)),k({sessionId:y}).then(function(e){e.data&&(C=e.data||[],z.dispatch(de(C)))}),T({sessionId:y}).then(function(e){e.data&&(j=e.data.point||0,z.dispatch(ue(j)))}),ht=setInterval(function(){Me.ping()},6e4),e.abrupt("break",126);case 46:if((D=gt[s])||(D=p[a]),x=(_=D).shopId,P=_.ddShopId,A=_.sourcePage,L=_.sourceContent,fe(a),f[a]||z.dispatch(ne(a,[])),yt(I,a,i,l),H=z.getState().roomShops,q=H[a]){e.next=61;break}return q={shopName:"\u5e97\u94fa\u540d",shopId:x,ddShopId:P,roomId:a},e.next=58,N({shopId:x,ddShopId:P,sourcePage:A});case 58:(M=e.sent).data&&(q=Object(r.a)({},q,M.data)),z.dispatch(Z(a,q));case 61:return D.roomId||(Se({type:"roomReady"}),D.roomId=a,b={roomId:a,shopName:q.shopName,shopPortrait:q.shopPortrait,shopId:x,ddShopId:P,sourcePage:A,sourceContent:L,unreadCount:0},z.dispatch(B(a,b))),vt(a),be(a,x,P),bt(I+1,a,c,i),z.dispatch(le(a)),e.abrupt("break",126);case 67:return Et(I,a,"\u5f53\u524d\u4f1a\u8bdd\u5df2\u7ecf\u7ed3\u675f"),z.dispatch(K(a,{status:-1})),O={msgType:"joinRoom",content:Object(r.a)({},b)},z.dispatch(oe(I+1,O)),z.dispatch(ae(a,[I+1])),e.abrupt("break",126);case 73:return It(I,a,b,g),O=Object(r.a)({senderType:E.userType||3},t.req,{msgUser:E}),z.dispatch(oe(I,O)),z.dispatch(ae(a,[I])),vt(a),ft(a,v,f),Me.sendMsg(a,7,s),e.abrupt("break",126);case 81:return"object"===typeof(F=t.res)&&(U=F.resMsg||0),z.dispatch(re(s,{msgStatus:"succ",seq:U})),ft(a,v,f),e.abrupt("break",126);case 86:if(d){e.next=88;break}return e.abrupt("return");case 88:return G=[],f[a].map(function(e){var t=v[e];t&&t.seq!=d.withdrawId&&G.push(e)}),z.dispatch(ne(a,G)),e.abrupt("break",126);case 92:return bt(I,a,c,i),yt(I,a,i,l),It(I,a,b,g),e.abrupt("break",126);case 96:return yt(I,a,i,l),It(I,a,b,g),e.abrupt("break",126);case 99:return e.abrupt("break",126);case 100:return Et(I,a,"\u5ba2\u670d\u9080\u8bf7\u60a8\u505a\u51fa\u8bc4\u4ef7"),a==g?z.dispatch(me(!0)):z.dispatch(B(a,{isComment:1})),It(I,a,b,g),e.abrupt("break",126);case 104:return Et(I,a,"\u8bc4\u8bba\u63d0\u4ea4\u6210\u529f"),z.dispatch(me(!1)),z.dispatch(B(a,{isComment:0})),z.dispatch(K(a,{hasCommented:1})),e.abrupt("break",126);case 109:case 110:return e.abrupt("break",126);case 111:return bt(I,a,c,i),It(I,a,b,activatedRoom),e.abrupt("break",126);case 114:return W=t.res.resMsg||"",O={msgType:1,content:W},z.dispatch(oe(I,O)),z.dispatch(ae(a,[I])),It(I,a,b,activatedRoom),e.abrupt("break",126);case 120:case 121:return e.abrupt("break",126);case 122:if(!(a<0)){e.next=124;break}return e.abrupt("return",alert("\u52a0\u5165\u623f\u95f4\u5931\u8d25"));case 124:return Et(I,a,"\u7f51\u7edc\u5f02\u5e38\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5"),e.abrupt("break",126);case 126:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();var St=document.getElementById("root");Object(l.render)(i.a.createElement(d.a,{store:z},i.a.createElement(ut,null)),St),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[27,1,2]]]);
//# sourceMappingURL=main.b2db0a27.chunk.js.map